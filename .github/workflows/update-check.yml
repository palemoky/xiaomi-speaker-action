name: Check for Updates

on:
  schedule:
    # æ¯å‘¨ä¸€æ—©ä¸Š 9 ç‚¹æ£€æŸ¥
    - cron: '0 1 * * 1' # UTC 1:00 = åŒ—äº¬æ—¶é—´ 9:00
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  check-updates:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6

      - uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest
          cache: 'bun'

      - name: Check for outdated dependencies
        run: |
          echo "## ðŸ“¦ Dependency Update Check" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # æ£€æŸ¥ npm ä¾èµ–
          echo "### npm Dependencies" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          bun outdated || echo "All dependencies are up to date!" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY

      - name: Check GitHub Actions versions
        run: |
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### GitHub Actions" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # æå–æ‰€æœ‰ä½¿ç”¨çš„ actions
          echo "Current actions in use:" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          grep -r "uses:" .github/workflows/ | grep -v "^#" | sed 's/.*uses: //' | sort -u >> $GITHUB_STEP_SUMMARY || true
          echo '```' >> $GITHUB_STEP_SUMMARY

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "> ðŸ’¡ Dependabot will automatically create PRs for updates" >> $GITHUB_STEP_SUMMARY
